---
// Cookie Banner Component
---

<div 
  id="cookie-banner" 
  class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50 transform translate-y-full transition-transform duration-300 ease-in-out"
  style="display: none;"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      
      <!-- Cookie Notice Text -->
      <div class="flex-1">
        <div class="flex items-start gap-3">
          <!-- Cookie Icon -->
          <div class="flex-shrink-0 mt-1">
            <svg class="w-5 h-5 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 2C5.58 2 2 5.58 2 10s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>
              <circle cx="7" cy="8" r="1"/>
              <circle cx="13" cy="8" r="1"/>
              <circle cx="10" cy="12" r="1"/>
              <circle cx="7" cy="13" r="0.5"/>
              <circle cx="13" cy="13" r="0.5"/>
            </svg>
          </div>
          
          <!-- Text Content -->
          <div class="min-w-0 flex-1">
            <p class="text-sm text-gray-800 leading-relaxed">
              We use cookies and similar technologies to enhance your experience, analyze website traffic, and provide personalized content. 
              By continuing to use our site, you consent to our use of cookies.
              <a href="/privacy" class="text-orange-600 hover:text-orange-500 underline font-medium ml-1">Learn more</a>
            </p>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 flex-shrink-0">
        <button 
          id="cookie-settings-btn"
          class="px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200"
        >
          Cookie Settings
        </button>
        <button 
          id="cookie-accept-btn"
          class="px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 rounded-lg transition-colors duration-200 whitespace-nowrap"
        >
          Accept All
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div 
  id="cookie-settings-modal" 
  class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
  style="display: none;"
>
  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    
    <!-- Modal Header -->
    <div class="border-b border-gray-200 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800">Cookie Preferences</h2>
        <button 
          id="cookie-modal-close"
          class="text-gray-400 hover:text-gray-600"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Modal Content -->
    <div class="p-6 space-y-6">
      
      <!-- Essential Cookies -->
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-3">
          <div>
            <h3 class="font-medium text-gray-800">Essential Cookies</h3>
            <p class="text-sm text-gray-600 mt-1">Required for basic website functionality</p>
          </div>
          <div class="flex items-center">
            <input 
              type="checkbox" 
              id="essential-cookies" 
              checked 
              disabled 
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500 opacity-50"
            >
            <label for="essential-cookies" class="ml-2 text-sm text-gray-500">Always On</label>
          </div>
        </div>
        <p class="text-sm text-gray-600">
          These cookies are necessary for the website to function and cannot be switched off. They include session management, security features, and basic functionality.
        </p>
      </div>

      <!-- Analytics Cookies -->
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-3">
          <div>
            <h3 class="font-medium text-gray-800">Analytics Cookies</h3>
            <p class="text-sm text-gray-600 mt-1">Help us understand how visitors use our website</p>
          </div>
          <div class="flex items-center">
            <input 
              type="checkbox" 
              id="analytics-cookies" 
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            >
          </div>
        </div>
        <p class="text-sm text-gray-600">
          These cookies collect information about how you use our website, such as which pages you visit and any errors you encounter. This data helps us improve our website performance.
        </p>
      </div>

      <!-- Marketing Cookies -->
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-3">
          <div>
            <h3 class="font-medium text-gray-800">Marketing Cookies</h3>
            <p class="text-sm text-gray-600 mt-1">Used to track visitors and display relevant ads</p>
          </div>
          <div class="flex items-center">
            <input 
              type="checkbox" 
              id="marketing-cookies" 
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            >
          </div>
        </div>
        <p class="text-sm text-gray-600">
          These cookies are used to make advertising messages more relevant to you and your interests. They also perform functions like preventing the same ad from appearing repeatedly.
        </p>
      </div>

    </div>

    <!-- Modal Footer -->
    <div class="border-t border-gray-200 p-6">
      <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
        <button 
          id="cookie-save-preferences"
          class="px-6 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        >
          Save Preferences
        </button>
        <button 
          id="cookie-accept-all"
          class="px-6 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 rounded-lg transition-colors"
        >
          Accept All
        </button>
      </div>
    </div>

  </div>
</div>

<script>
  // Cookie banner functionality
  document.addEventListener('DOMContentLoaded', function() {
    const banner = document.getElementById('cookie-banner');
    const modal = document.getElementById('cookie-settings-modal');
    const acceptBtn = document.getElementById('cookie-accept-btn');
    const settingsBtn = document.getElementById('cookie-settings-btn');
    const modalClose = document.getElementById('cookie-modal-close');
    const savePreferencesBtn = document.getElementById('cookie-save-preferences');
    const acceptAllBtn = document.getElementById('cookie-accept-all');

    // Check if cookies have been accepted
    const cookiesAccepted = localStorage.getItem('cookiesAccepted');
    
    if (!cookiesAccepted) {
      // Show banner after a short delay
      setTimeout(() => {
        if (banner) {
          banner.style.display = 'block';
          banner.classList.remove('translate-y-full');
        }
      }, 1000);
    }

    // Accept all cookies
    function acceptAllCookies() {
      localStorage.setItem('cookiesAccepted', 'true');
      localStorage.setItem('analyticsEnabled', 'true');
      localStorage.setItem('marketingEnabled', 'true');
      hideBanner();
      enableAnalytics();
    }

    // Save cookie preferences
    function saveCookiePreferences() {
      const analyticsCheckbox = document.getElementById('analytics-cookies') as HTMLInputElement;
      const marketingCheckbox = document.getElementById('marketing-cookies') as HTMLInputElement;
      const analyticsEnabled = analyticsCheckbox?.checked || false;
      const marketingEnabled = marketingCheckbox?.checked || false;
      
      localStorage.setItem('cookiesAccepted', 'true');
      localStorage.setItem('analyticsEnabled', analyticsEnabled.toString());
      localStorage.setItem('marketingEnabled', marketingEnabled.toString());
      
      if (analyticsEnabled) {
        enableAnalytics();
      }
      
      hideBanner();
      hideModal();
    }

    // Hide banner
    function hideBanner() {
      if (banner) {
        banner.classList.add('translate-y-full');
        setTimeout(() => {
          banner.style.display = 'none';
        }, 300);
      }
    }

    // Show modal
    function showModal() {
      if (modal) {
        modal.style.display = 'flex';
        // Load current preferences
        const analyticsEnabled = localStorage.getItem('analyticsEnabled') === 'true';
        const marketingEnabled = localStorage.getItem('marketingEnabled') === 'true';
        
        const analyticsCheckbox = document.getElementById('analytics-cookies') as HTMLInputElement;
        const marketingCheckbox = document.getElementById('marketing-cookies') as HTMLInputElement;
        
        if (analyticsCheckbox) analyticsCheckbox.checked = analyticsEnabled;
        if (marketingCheckbox) marketingCheckbox.checked = marketingEnabled;
      }
    }

    // Hide modal
    function hideModal() {
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Enable analytics
    function enableAnalytics() {
      // Analytics is already loaded in the layout, this is just for consistency
      if (typeof (window as any).gtag !== 'undefined') {
        (window as any).gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
    }

    // Event listeners
    acceptBtn?.addEventListener('click', acceptAllCookies);
    settingsBtn?.addEventListener('click', showModal);
    modalClose?.addEventListener('click', hideModal);
    savePreferencesBtn?.addEventListener('click', saveCookiePreferences);
    acceptAllBtn?.addEventListener('click', () => {
      acceptAllCookies();
      hideModal();
    });

    // Close modal when clicking outside
    modal?.addEventListener('click', (e) => {
      if (e.target === modal) {
        hideModal();
      }
    });

    // Initialize analytics consent based on stored preferences
    if (cookiesAccepted) {
      const analyticsEnabled = localStorage.getItem('analyticsEnabled') === 'true';
      if (analyticsEnabled && typeof (window as any).gtag !== 'undefined') {
        (window as any).gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
    }
  });
</script>

<style>
  /* Ensure the banner doesn't interfere with page scrolling */
  #cookie-banner {
    max-height: 200px;
  }
  
  /* Smooth scrolling adjustments */
  body:has(#cookie-banner:not(.translate-y-full)) {
    padding-bottom: 120px;
  }
</style>